# AI対話型コスメ検索 プロダクト仕様書

## 1. プロジェクト概要

### 1.1 目的と背景
- **目的**: 従来のキーワード検索では発見できなかった商品との出会いを創出し、ユーザーの購買体験を向上させる新しい検索体験を PoC として実証する。
- **背景**:
  - 従来のスコアベース検索では、ユーザーが適切な検索キーワードを知っている必要があり、潜在的なニーズに合った商品の発見が困難。
  - コスメ商品には多様な属性（質感、仕上がり、使用シーン等）があり、ユーザーが全ての選択軸を事前に認識することは難しい。
  - AI による対話型の絞り込みにより、ユーザー自身も気づいていなかった商品特性やニーズを顕在化させる。

### 1.2 ターゲットユーザー
- コスメ商品（メイクアップ・スキンケア）を探しているユーザー。
- 自分に合った商品を見つけたいが、何を基準に選べばよいか迷っているユーザー。
- 新しい商品との出会いを求めているユーザー。

### 1.3 解決する課題
- **ユーザー側の課題**:
  - 単一の検索キーワード入力だけでは、自分に合う切り口（例: 形状や仕上がり）に気づきづらく、最適な商品にたどり着きにくい。
  - 商品の選択肢が多すぎて比較検討が困難。
  - 商品詳細ページやレビューの情報量が多く、読み込みに時間がかかる。
- **システム側の課題**:
  - 従来のスコアマッチングでは、ユーザーの潜在的ニーズを捉えきれない。
  - 商品属性の多様性を活かしきれていない。

### 1.4 PoC の範囲
- **対象商品カテゴリ**: メイクアップ、スキンケア。
- **実装機能**:
  - AI 対話型検索機能（2〜5 回の質問による絞り込み）。
  - マッチ度スコア表示機能（肌診断 API を介した相性チェック導線を含む）。
  - 商品詳細ページの AI 生成情報表示（おすすめポイント、レビュー要約）。
  - 検索履歴の保存機能（セッション内）。
- **実装しない機能（将来的な拡張候補）**:
  - ユーザー認証機能。
  - ユーザープロファイルベースの商品相性度算出。
  - 既存システムとのデータ連携。
  - メイクアップ・スキンケア以外のカテゴリ。

### 1.5 成功指標（KPI 候補）
- AI 対話型検索の完遂率（最後まで質問に答えたユーザーの割合）。
- 検索結果からの商品詳細ページ遷移率。
- 従来型検索との比較（検索から商品発見までの時間、満足度）。

## 2. 想定ユーザーとユースケース
- **ペルソナ例**: 20〜40 代の美容意識が高い女性。忙しくても短時間で自分に合うコスメ情報を得たい。オンライン購入経験あり。
- **利用シナリオ**:
  1. 日焼け止めの種類が多く選べないため AI に相談したい。
  2. 肌質や使用シーンを入力しながらおすすめ商品を知りたい。
  3. レビューを要約した情報で購買判断したい。

## 3. ユーザーフロー
1. トップ画面でキーワード検索 or 人気キーワードタップ。
2. 検索結果画面で一覧を確認し、AIサポート開始ボタンを押す。
3. AI対話画面で質問に回答（形状 → SPF）。
4. 回答に基づいた絞り込み結果を確認し、「相性チェック」を押下。
5. 肌診断画面に遷移し、カメラを起動して顔写真を撮影。
6. 撮影完了後にローディング表示（約 1 秒）を経て診断結果を取得し、自動で元の画面へ戻る。
7. 戻ってきた画面で相性度スコアが反映された状態の商品を比較し、興味のある商品を選択。
8. 商品詳細ページでも必要に応じて「相性チェック」を実施しつつ内容を確認。
9. カート投入（現時点は UI 上の擬似ボタン）。

## 4. 画面仕様
### 4.1 画面0: 検索入力
- **要素**: アプリヘッダー、検索フォーム、検索ボタン、人気キーワードチップ。
- **動作**: 検索ボタン or チップ押下で検索語がセットされ、画面1へ遷移。
- **入力バリデーション**: 空文字の場合は遷移可能（将来の検討事項）。

### 4.2 画面1: 検索結果
- **要素**: 検索語表示ボックス、AIお手伝いカード、商品一覧（5件表示）。
- **動作**:
  - 「はじめる」押下で画面2へ。
  - 商品カード押下で画面5へ（現状は最初の商品詳細を表示）。
- **補足**: 検索結果はダミーデータ。将来は API 連携を想定。

### 4.3 画面2: 質問1（形状）
- **要素**: AIヘッダー、質問カード（タイトル、説明、4択ボタン）、戻る/スキップボタン。
- **動作**: 選択またはスキップで画面3へ。戻るで画面1へ。選択内容は今後ステート管理で使用予定（現時点の実装では遷移のみ）。

### 4.4 画面3: 質問2（SPF）
- **構成**: 画面2と同様。選択/スキップで画面4へ、戻るで画面2へ。
- **将来要件**: ユーザー回答を保存し、推薦ロジックに反映する。

### 4.5 画面4: 絞り込み結果
- **要素**: 推薦ヘッダー、推薦商品カード（2件）。初期状態では各カードに「相性チェック」ボタン、理由タグ、レビュー要約を表示。
- **動作**:
  - 「相性チェック」押下で肌診断画面（画面6）へ遷移し、診断が完了するとカード上に相性度スコアが表示される。
  - カード押下で画面5へ。相性チェック済みの場合は詳細画面にもスコアを引き継ぐ。
- **データ要求**: 相性チェック結果（スコア、診断タイムスタンプ）、理由ラベル、レビュー要約を保持。診断完了時はおすすめ商品すべてに最新スコアを同時反映する。

### 4.6 画面5: 商品詳細
- **要素**: 商品ビジュアル、価格、相性度スコア（相性チェック済みのみ表示）、マッチ理由、レビュー要約、特徴リスト、詳細閲覧ボタン（テキスト: 「商品情報を詳しく見る」）。
- **動作**:
  - 相性チェック未実行の場合は「相性チェック」ボタンを表示し、押下で肌診断画面（画面6）へ遷移。診断完了後にスコアが表示される。
  - 戻るで画面4へ。カートボタン押下時の挙動は今後定義。
- **補足**: 詳細画面から実行した診断結果は画面4にも反映され、最新スコアは他の商品カードにも同時適用される。

### 4.7 画面6: 肌診断
- **要素**: アプリヘッダー（戻るボタン含む）、カメラプレビュー領域、ガイド文言、撮影ボタン、ローディング表示（「診断中…」＋走る子猫アニメーション）、エラー表示（「失敗しました」＋戻るボタン）。
- **動作**:
  - 画面遷移時にカメラプレビューを表示し、「撮影する」ボタンで顔写真を取得。
  - 撮影後にローディングへ遷移し、約 1 秒で肌診断 API の結果（相性度スコア）を取得。
  - 成功時は自動で元の画面へ戻り、対象商品のスコアを表示。失敗時は「失敗しました」メッセージと「戻る」ボタンで元の画面へ戻る。

## 5. 機能要件
1. **画面遷移管理**: 単一ページ内で state を用いて 6 画面を切り替える。
2. **検索キーワード保持**: 画面0 → 画面1 で入力した検索語を表示。人気キーワード選択時は query が上書き。
3. **AI対話フロー**: 質問画面の選択結果を state に保持できるよう拡張余地を確保（現状は TODO）。
4. **推奨候補表示**: 肌診断 API 実行後の相性度スコアや理由タグを表示。将来的にアルゴリズムと接続する前提でデータ構造を定義。
5. **肌診断フロー**: 「相性チェック」押下で肌診断画面へ遷移し、カメラ撮影 → ローディング → 元画面へ戻る流れを実装。ローディング中は「診断中…」＋走る子猫アニメーションを表示し、失敗時は「失敗しました」＋戻るボタンを表示する。
6. **アクセシビリティ**: 絵文字アイコンには `role` と `aria-label` を付与。
7. **レスポンシブ**: 400px 幅をベースとしたモバイル UI。将来的に幅可変対応を検討。

## 6. 非機能要件
- **パフォーマンス**: 初期表示で TTI 1秒以内（ローカル環境）。外部 API 連携時はローディング表示追加。
- **外部連携**: 肌診断 API の応答目標は 1 秒以内。タイムアウト時はユーザーに再実行手段を提示。
- **UI 一貫性**: ローディングとエラーメッセージの文言は「診断中…」「失敗しました」で統一。子猫アニメーションのフレームレート・サイズは肌診断画面で共通設定とする。
- **コード品質**: ESLint を活用し、React Hooks ルールを順守。
- **国際化**: 初期は日本語固定。将来的に多言語化に備え、文言はコンポーネント外部で一元管理予定。
- **データ管理**: 現在は静的データ。API 連携前提で TypeScript 化を検討中（TODO）。

## 7. 既知の制約・TODO
- 推薦ロジック未実装。ユーザー回答を使ったフィルタリングは今後実装。
- カート機能は UI のみ。バックエンド未接続。
- 画像はプレースホルダー。実画像取得方法は未確定。
- バリデーション、エラー表示、ローディング表示は未実装。
- 肌診断 API はモックを前提。実サービス連携時の認証やデータ形式は未定義（Perfect社 API 利用予定）。

## 8. リリースマイルストーン
1. **MVP (現状)**: 静的データで画面フロー確認。
2. **Phase 2**: ダイアログ回答と推薦ロジックの連動、カート連携 API の設計。
3. **Phase 3**: レビュー要約の自動生成（LLM 連携）、ユーザー履歴に基づくパーソナライズ。

## 9. KPI と計測基盤（将来）
- 画面遷移トラッキング（開始〜完了まで）。
- 選択肢選択率、スキップ率。
- 推薦商品クリック率。
- カート投入 / 購買コンバージョン率。

## 10. 変更管理
- 仕様変更は docs/spec.md を更新し、変更履歴セクションを追加する。
- 実装タスクは仕様からチケット化し、スペック駆動開発プロセスに沿って実施。
