# スペック駆動開発ルール

## 1. 全体方針
- 仕様（`docs/spec.md`）を単一の信頼できる情報源とし、実装前に必ず確認・更新する。
- 追加要件や不明点が発生した場合は、仕様書の改訂→レビュー→承認を経てから実装を開始する。
- 仕様が確定していないタスクは実装開始不可。仕様確定までに調査が必要な場合はリサーチタスクとして扱う。

## 2. プロセスと責任範囲
1. **要求定義**: プロダクトオーナー（PO）が要求を記述。背景・目的・受入条件を明記。
2. **仕様策定**: デザイナー／エンジニアが仕様案を `docs/spec.md` に反映。影響範囲と非機能要件も記す。
3. **レビュー & 承認**: PO と開発リードがレビュー。承認後にステータスを「Ready for Dev」に更新。
4. **実装**: 担当者は仕様に沿って開発。仕様差異が判明した場合は即座に仕様書を更新し、再承認を受ける。
5. **検証**: テストケースに基づき検証。結果をタスクに記録し、問題があれば仕様へフィードバック。
6. **リリース**: リリースノートに仕様変更点を転記し、仕様書と同期させる。

## 3. ドキュメント運用ルール
- 仕様書の更新日は文末に「更新履歴」として追加（例: `- 2025-02-16: サーチバリデーションを追加 (担当: XXX)`）。
- 図表やワイヤーフレームは `docs/assets` ディレクトリに配置し、仕様書から相対パスで参照。
- 仕様の未確定項目には `TODO:` ラベルを付与し、チケットと紐付ける。

## 4. チケット・タスク管理
- **チケット構成**: 背景 / 目的 / 仕様差分リンク / 受入基準 / 作業項目 / 懸念事項。
- **Definition of Ready**:
  - 仕様と受入基準が明文化されている。
  - 依存タスクが明確になっている。
  - テスト方針が記されている。
- **Definition of Done**:
  - 実装が仕様と一致し、テストがパスしている。
  - 仕様書/ドキュメント/Storybook 等が最新に更新されている。
  - コードレビューを通過し、デプロイ準備が整っている。

## 5. リポジトリ運用
- **ブランチ命名**: `feature/<ticket-id>-<short-desc>` / `fix/...` / `docs/...`。ドキュメントのみ変更時もブランチを切る。
- **コミットメッセージ**: `<type>: <summary>` を基本とし、`spec`, `docs`, `feat`, `fix`, `chore` などを利用。
- **PR テンプレート**（推奨）:
  1. 概要
  2. 仕様リンク
  3. 受入基準チェックリスト
  4. テスト結果
  5. 影響範囲

## 6. コーディング規約（要約）
- React + Vite 標準構成。Hooks を使用し、クラスコンポーネントは禁止。
- CSS はモジュール化前提で、長期的にはデザインシステム（例: Tailwind, CSS-in-JS）の導入を検討。
- 文言は後の国際化に備え、専用ファイル・定数へ切り出す。
- Magic number やハードコードは仕様書に根拠を記載し、コメントで補足。

## 7. テスト方針
- **ユニットテスト**: 主要ロジック（例: 推薦アルゴリズム）が実装され次第、Vitest でカバレッジを確保。
- **スナップショット**: UI 変更が多い画面は Storybook + Chromatic 等での可視化を検討。
- **E2E テスト**: Cypress / Playwright を利用し、対話フロー完了までのシナリオテストを実装する。
- テストコードも仕様に沿うことを確認し、変更時は仕様にテスト項目を追記。

## 8. リリース・品質保証
- ステージング環境で仕様書の受入基準を手動確認。
- QA チェックリスト例:
  - 画面遷移が仕様通りか。
  - 表示文言に誤りや漏れがないか。
  - ボタンホバーやタップレスポンスがデザインと一致するか。
  - アクセシビリティ属性が付与されているか。

## 9. ナレッジ共有
- 実装で得た知見は Notion / Confluence 等にまとめ、`docs/spec.md` または `docs/development-rules.md` へリンクを追加。
- 定例ミーティングで仕様変更・課題を共有し、合意形成を図る。

## 10. 継続的改善
- 各スプリント完了時に仕様ドキュメントと実装の差分をレビューし、ギャップを埋める。
- スペック駆動開発の運用で課題が出た場合は、本ドキュメントに改善策を追記。
