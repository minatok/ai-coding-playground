# バーコードスキャン Web アプリ プロトタイプ仕様書

## 1. プロジェクト概要

### 1.1 目的と背景
- **目的**: 店舗内での商品比較を支援するバーコードスキャンアプリの体験プロトタイプを作成し、スキャン → ローディング → 商品詳細表示までの UX を検証する。
- **背景**:
  - 店頭で商品情報を検索する際、ユーザーはブラウザで商品名を調べるなどの手間がかかる。
  - バーコードを読み取るだけで即座に評価やサマリーを提示できれば、購入判断を高速化できる。
  - 既存の ai-cosme-search / product-page-prototype と連動し、フィジカル店舗での活用シナリオを補完したい。

### 1.2 ターゲットユーザー
- ドラッグストアやバラエティショップでコスメを比較購入する 20〜40 代の女性。
- EC サイトよりもリアル店舗で商品を手に取ってから詳細を調べたいユーザー。
- 時間が限られており、サクッとメリット・デメリットを知りたいユーザー。

### 1.3 解決する課題
- **ユーザー課題**:
  - 店内で商品ごとの口コミや評価を素早く確認できない。
  - バーコードから得られる情報が限られている（価格のみなど）。
- **ビジネス課題**:
  - 店舗での購入体験をデジタルで補完し、商品発見率と購買意欲を高めたい。
  - 店舗在庫データやレビューを有効活用する導線を検証したい。

### 1.4 プロトタイプ範囲
- **対象カテゴリ**: コスメ商品（ダミーデータ 3 件）。
- **機能範囲**:
  - ホーム、バーコード入力、ローディング、商品詳細、エラーの 5 画面。
  - バーコード手入力によるスキャン疑似体験。
- **対象外**:
  - 実際のカメラ起動・バーコード読み取り。
  - API 連携。現状はフロントエンド内のモックデータ。

## 2. 想定ユーザーとユースケース
- **ペルソナ例**: 32 歳、乾燥肌、仕事帰りにドラッグストアでコスメを購入。スマホで口コミをチェックする習慣がある。
- **ユースケース**:
  1. 商品棚でバーコードをスキャンし評価・要約を確認。
  2. メリット／デメリットを比較しながら短時間で購入判断。
  3. 詳細情報が必要な場合は公式ページへ遷移。
  4. 求めている商品でなければ別の商品を続けてスキャン。

## 3. ユーザーフロー
1. ホーム画面で「バーコードをスキャン」ボタンを押す。
2. バーコード入力画面で数字を入力 → 検索。
3. ローディング画面が表示され、商品検索を待つ。
4. 対応商品があれば商品詳細へ遷移し、評価・要約・メリット／デメリット・外部リンクを確認。
5. 別の商品をスキャンする場合は専用ボタン、最初の画面へ戻る場合はヘッダーの「戻る」を使用。
6. 該当商品が無い場合やエラー時はエラー画面に遷移し、再試行またはホームへ戻る。

## 4. 画面仕様

### 4.1 画面A: ホーム
- **要素**: アプリ名、説明文、スキャン開始ボタン、使い方ガイド、テスト用バーコード一覧。
- **挙動**: ボタン押下でバーコード入力画面へ遷移。

### 4.2 画面B: バーコード入力
- **要素**: バーコード入力フォーム、検索ボタン、キャンセルボタン。
- **挙動**:
  - 検索ボタン or Enter キーで検索開始。空文字の場合は無視。
  - キャンセル押下でホーム画面に戻る。
  - 入力完了後はローディング画面を経由して結果へ。

### 4.3 画面C: ローディング
- **要素**: スピナーアイコン、待機メッセージ。
- **挙動**: `fetchProductData` の結果を待つ。1.5 秒のダミー遅延を挟んで商品詳細またはエラーへ遷移。

### 4.4 画面D: 商品詳細
- **要素**:
  - ヘッダー（戻るボタン）。
  - 商品基本情報（画像、カテゴリ、商品名、メーカー、バーコード）。
  - 評価・クチコミ要約（平均スコア、レビュー件数、ポジ/ニュートラル/ネガティブ割合、ハイライトキーワード、約 200 文字のサマリー）。
  - 特徴セクション（メリット／デメリットリスト）。
  - 外部リンクボタン（商品ページ）、別商品をスキャンボタン。
- **挙動**:
  - 戻るでホームへ遷移。
  - 別商品をスキャンでバーコード入力画面へ遷移。
  - 外部リンクは別タブで開く。

### 4.5 画面E: エラー
- **要素**: エラーアイコン、タイトル、メッセージ、再試行ボタン、ホームへ戻るボタン。
- **エラー種別**:
  - `notFound`（現行実装では未登録バーコードで発生）。
  - `networkError`（将来 API 連携時に利用想定）。
  - `invalidBarcode`（バーコード形式チェック追加時に利用想定）。
- **挙動**: 再試行でバーコード入力、ホームでトップへ遷移。

## 5. 機能要件
1. **ステート管理**: `screen`, `product`, `loading`, `error` を React Hooks で管理し、画面遷移を制御する。
2. **バーコード検索**: `fetchProductData` を通じてダミー商品データを取得。1.5 秒の遅延を挟んで結果を返す。
3. **ローディング表示**: 検索中はローディング画面をオーバーレイ表示し、`loading` が false になるまで他 UI をブロックする。
4. **エラーハンドリング**: 商品が見つからない場合は `error` に `notFound` を設定しエラー画面へ遷移。再試行時にエラーをリセット。
5. **アクセシビリティ配慮**: アイコンに `aria-hidden` を付与、ボタンには `type="button"` を明示し、キーボード操作でも動作するよう `onKeyDown` を利用。
6. **レスポンシブ**: スマホ〜タブレット幅での利用を想定した Tailwind レイアウト。最大幅 2xl で中央寄せ。
7. **クチコミ要約表示**: 平均スコア・レビュー件数・割合・キーワードを表示しつつ、要約文を 200 文字前後に整形して提示する。

## 6. 非機能要件
- **パフォーマンス**: Vite + React 構成。ローカル環境で初期表示が 1 秒以内になるよう軽量化。
- **依存ライブラリ**: `lucide-react`, Tailwind CSS。MIT ライセンスの OSS を使用。
- **可用性**: ダミーデータはフロントエンド内に保持。ネットワーク接続が無くても動作（外部画像取得を除く）。
- **コード品質**: 関数コンポーネントで構成。将来的にコンテキストや状態管理ライブラリ導入を検討可能な構造。
- **国際化**: 日本語 UI 固定。多言語化は範囲外。

## 7. 既知の制約・TODO
- 実際のバーコード読み取り機能（カメラ API）未実装。
- 商品データは静的。バックエンド連携や検索 API は未接続。
- ネットワークエラー・無効バーコードなどの分岐は一部ダミー。
- レビューサマリーは固定テキスト。自動生成ロジックは未実装。
- ログ・計測・テストコードは現状なし。

## 8. 今後の拡張候補
1. **カメラ連携**: WebRTC / ZXing などを利用したリアルタイムバーコード読み取り。
2. **API 接続**: 商品マスタ・レビュー API との統合。認証・レートリミット対応。
3. **レコメンド**: 類似商品や人気ランキングの表示。
4. **オフライン機能**: 店舗内 Wi-Fi が不安定でも動作するキャッシュ戦略。
5. **イベント計測**: スキャン成功率、エラー種別、詳細ページ遷移率などのログ基盤整備。
